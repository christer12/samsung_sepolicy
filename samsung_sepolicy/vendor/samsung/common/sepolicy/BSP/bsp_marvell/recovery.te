# grant additional permission for recovery
#SEC added:
recovery_only(`
#write_klog(recovery)
type_transition recovery device:chr_file klog_device "__kmsg__";
allow recovery klog_device:chr_file { create open write unlink };
allow recovery device:dir { write add_name remove_name };

access_kmsg(recovery)

allow recovery cache_file:dir create_dir_perms;
allow recovery rootfs:dir create_dir_perms;
allow recovery rootfs:file entrypoint;
allow recovery tmpfs:dir create_dir_perms;
allow recovery tmpfs:file create_file_perms;
allow recovery self:capability { fowner chown dac_override sys_admin fsetid sys_tty_config };
allow recovery self:capability2 block_suspend;
allow recovery self:process setfscreate;
allow recovery cache_file:dir create_dir_perms;
allow recovery cache_file:file create_file_perms;
allow recovery input_device:chr_file create_file_perms;
allow recovery input_device:dir create_dir_perms;
allow recovery kernel:process setsched;
allow recovery labeledfs:filesystem { mount unmount };
allow recovery powerctl_prop:property_service set;
allow recovery rootfs:dir create_dir_perms;
allow recovery init:unix_stream_socket connectto;
allow recovery nvm_data_file:dir r_dir_perms;
allow recovery nvm_data_file:file r_file_perms;
allow recovery property_socket:sock_file create_file_perms;
allow recovery tty_device:chr_file create_file_perms;
allow recovery device:dir create_dir_perms;
allow recovery graphics_device:chr_file create_file_perms;
allow recovery graphics_device:dir create_dir_perms;
allow recovery rootfs:file x_file_perms;
allow recovery proc:file create_file_perms;
allow recovery self:process execmem;
allow recovery sysfs:file create_file_perms;

allow recovery clatd_exec:file create_file_perms;
allow recovery debuggerd_exec:file create_file_perms;
allow recovery dhcp_exec:file create_file_perms;
allow recovery dnsmasq_exec:file create_file_perms;
allow recovery drmserver_exec:file create_file_perms;
allow recovery hostapd_exec:file create_file_perms;
allow recovery installd_exec:file create_file_perms;
allow recovery keystore_exec:file create_file_perms;
allow recovery mediaserver_exec:file create_file_perms;
allow recovery mtp_exec:file create_file_perms;
allow recovery ppp_exec:file create_file_perms;
allow recovery tee_exec:file create_file_perms;
allow recovery racoon_exec:file create_file_perms;
allow recovery rild_exec:file create_file_perms;
allow recovery runas_exec:file create_file_perms;
allow recovery sdcardd_exec:file create_file_perms;
allow recovery servicemanager_exec:file create_file_perms;
allow recovery su_exec:file create_file_perms;
allow recovery surfaceflinger_exec:file create_file_perms;
allow recovery system_file:dir create_dir_perms;
allow recovery system_file:file create_file_perms;
allow recovery system_file:lnk_file create_file_perms;
allow recovery unlabeled:dir create_dir_perms;
allow recovery unlabeled:file create_file_perms;
allow recovery vold_exec:file create_file_perms;
allow recovery wpa_exec:file create_file_perms;
allow recovery zygote_exec:file create_file_perms;
allow recovery netd_exec:file create_file_perms;
allow recovery shell_exec:file create_file_perms;
allow recovery marvelltel_exec:file create_file_perms;
allow recovery FMRadiod_exec:file create_file_perms;
allow recovery mwirelessd_exec:file create_file_perms;
allow recovery iml_exec:file create_file_perms;
allow recovery imsc_exec:file create_file_perms;
allow recovery mned_exec:file create_file_perms;
allow recovery touch_updater_exec:file create_file_perms;
allow recovery phservice_exec:file create_file_perms;
allow recovery kmsg_exec:file create_file_perms;
allow recovery root_detect_exec:file create_file_perms;
allow recovery load_g_cali_data_exec:file create_file_perms;
allow recovery bootanim_exec:file create_file_perms;
allow recovery dumpstate_exec:file create_file_perms;
allow recovery vold_exec:file create_file_perms;
allow recovery mdnsd_exec:file create_file_perms;
allow recovery sdcardd_exec:file create_file_perms;
allow recovery gpsd_exec:file create_file_perms;
allow recovery lmkd_exec:file create_file_perms;
allow recovery inputflinger_exec:file create_file_perms;
allow recovery logd_exec:file create_file_perms;
allow recovery uncrypt_exec:file create_file_perms;
allow recovery vdc_exec:file create_file_perms;
allow recovery install_recovery_exec:file create_file_perms;
allow recovery dex2oat_exec:file create_file_perms;

allow recovery block_device:dir create_dir_perms;
#SEC removed : allow recovery block_device:blk_file create_file_perms;
#SEC removed : allow recovery cploader_block_device:blk_file create_file_perms;
#SEC removed : allow recovery mrd_block_device:blk_file create_file_perms;
#SEC removed : allow recovery mrd1_block_device:blk_file create_file_perms;
#SEC removed : allow recovery dtim_block_device:blk_file create_file_perms;
#SEC removed : allow recovery recovery_block_device:blk_file create_file_perms;
#SEC removed : allow recovery bootloader_block_device:blk_file create_file_perms;
#SEC removed : allow recovery splash_block_device:blk_file create_file_perms;
#SEC removed : allow recovery boot_block_device:blk_file create_file_perms;
#SEC removed : allow recovery system_block_device:blk_file create_file_perms;
#SEC removed : allow recovery misc_block_device:blk_file create_file_perms;
#SEC removed : allow recovery radio_block_device:blk_file create_file_perms;
#SEC removed : allow recovery nvm_block_device:blk_file create_file_perms;
#SEC removed : allow recovery cache_block_device:blk_file create_file_perms;
#SEC removed : allow recovery fota_block_device:blk_file create_file_perms;
#SEC removed : allow recovery userdata_block_device:blk_file create_file_perms;

allow recovery atcmdsrv_exec:file relabelto;
allow recovery bootanim_exec:file relabelto;
allow recovery clatd_exec:file { relabelfrom relabelto };
allow recovery debuggerd_exec:file { relabelfrom relabelto };
allow recovery dex2oat_exec:file relabelto;
allow recovery dhcp_exec:file { relabelfrom relabelto };
allow recovery diag_exec:file relabelto;
allow recovery dnsmasq_exec:file { relabelfrom relabelto };
allow recovery drmserver_exec:file { relabelfrom relabelto };
allow recovery hostapd_exec:file { relabelfrom relabelto };
# Only QZ3 has this file
# allow recovery hwinfo_exec:file relabelto;
allow recovery iml_exec:file relabelto;
allow recovery imsc_exec:file relabelto;
allow recovery install_recovery_exec:file relabelto;
allow recovery installd_exec:file { relabelfrom relabelto };
allow recovery keystore_exec:file { relabelfrom relabelto };
allow recovery lmkd_exec:file relabelto;
allow recovery load_g_cali_data_exec:file relabelto;
allow recovery log_on_boot_exec:file relabelto;
allow recovery logd_exec:file relabelto;
allow recovery mdnsd_exec:file relabelto;
allow recovery mediaserver_exec:file { relabelfrom relabelto };
allow recovery mtp_exec:file { relabelfrom relabelto };
allow recovery mwirelessd_exec:file relabelto;
allow recovery netd_exec:file { relabelfrom relabelto };
allow recovery nvm_exec:file relabelto;
allow recovery ppp_exec:file { relabelfrom relabelto };
allow recovery pppmodem_exec:file relabelto;
allow recovery racoon_exec:file { relabelfrom relabelto };
allow recovery rild_exec:file { relabelfrom relabelto };
allow recovery root_detect_exec:file relabelto;
allow recovery runas_exec:file { relabelfrom relabelto };
allow recovery sdcardd_exec:file { relabelfrom relabelto };
allow recovery self:capability setfcap;
# Only QZ3 has this file
# allow recovery sensord_exec:file relabelto;
allow recovery setup_fs_exec:file relabelto;
allow recovery shell_exec:file relabelto;
allow recovery surfaceflinger_exec:file { relabelfrom relabelto };
allow recovery system_file:dir { relabelfrom relabelto };
allow recovery system_file:file { relabelfrom relabelto };
allow recovery system_file:lnk_file { relabelfrom relabelto };
allow recovery uncrypt_exec:file relabelto;
allow recovery unlabeled:dir relabelfrom;
allow recovery unlabeled:file relabelfrom;
allow recovery vdc_exec:file relabelto;
allow recovery vold_exec:file { relabelfrom relabelto };
allow recovery wpa_exec:file { relabelfrom relabelto };
allow recovery zygote_exec:file relabelto;
allow recovery dumpstate_exec:file relabelto;
allow recovery eeh_exec:file relabelto;
allow recovery marvelltel_exec:file relabelto;
allow recovery phservice_exec:file relabelto;
allow recovery servicemanager_exec:file relabelto;
allow recovery cache_file:dir mounton;
allow recovery rootfs:dir mounton;
#SEC added:
')

