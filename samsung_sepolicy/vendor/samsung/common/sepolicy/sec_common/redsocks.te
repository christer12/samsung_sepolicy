#
# redsocks
#
# This process listen on local socket (127.0.0.1) for all tcp packet. It makes  tcp socket connection with given IP and port. And redirect/send all local packet to connected destination address.
# This service reads a configuration file from /data/gigapath/redsocks.conf. This configuration file is created by a system service. 
# Configuration file path is always under /data/... But sub directory is created by system server and its name might change with different operator.
# Contact : bhagwan.dass // SRI

# Basic Form of every rule
# 1.PLM/JIRA #, OS, AP, Process Info : PXXXX-XXXX, M, Exynos5, android.process.xxxx
# 2.comment and reason :
# 3.Rule:
# 4.Log with system call :

########## type, macro
type redsocks, domain;
type redsocks_exec, exec_type, file_type;

# service redsocks /system/bin/redsocks -c /data/gigapath/redsocks.conf
init_daemon_domain(redsocks)

# use the network.
net_domain(redsocks)

########## domain_rule
# root uid to create raw socket and has differce uid with the conf file.
# avc:  denied  { dac_override } for  pid=11126 comm="redsocks" capability=1  scontext=u:r:redsocks:s0 tcontext=u:r:redsocks:s0 tclass=capability permissive=1
# avc:  denied  { net_admin } for  pid=11126 comm="redsocks" capability=12  scontext=u:r:redsocks:s0 tcontext=u:r:redsocks:s0 tclass=capability permissive=1
# avc:  denied  { net_raw } for  pid=11126 comm="redsocks" capability=13  scontext=u:r:redsocks:s0 tcontext=u:r:redsocks:s0 tclass=capability permissive=1
allow redsocks self:capability { dac_override net_raw net_admin };


########## fs_rule
########## dev_rule
########## file_rule
# Allow redsocks to open file<redsocks conf file, generated by system/framework>
# avc:  denied  { open } for  pid=11260 comm="redsocks" path="/data/gigapath/redsocks.conf" dev="dm-0" ino=327687 scontext=u:r:redsocks:s0 tcontext=u:object_r:system_data_file:s0 tclass=file permissive=1
# open and read /data/gigapath/redsocks.conf
allow redsocks system_data_file:file r_file_perms;

allow redsocks system_file:file x_file_perms;

########## etc_rule
########## multiple_rule

############ additional avc_log #############


